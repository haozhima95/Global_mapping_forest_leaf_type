---
title: "Untitled"
author: "Haozhi Ma"
date: "11/9/2022"
output: html_document
---

This script is used for reconstructing the figures of climate change on evergreenness and leaf form change.

Load the dataset. The code in google earth engine has changed, thus leading to a big dataset with rcp and model information. Mean of all latitudinal tiles are selected. For each climate change scenario, five lines will be used to illustrate how different models predicts for future leaf habit and leaf form change


```{R}
evedf <- read.csv('C:\\Users\\haozh\\Desktop\\LL\\future_clim\\eve_difference_allmodel_allrcp_20221010.csv')

head(evedf,10L)

names(evedf)
#unique(evedf)
unique(evedf$name)


unique(evedf$rcp)
```


```{R}
library(dplyr)



```


```{R}

evesummary <- evedf %>%
  group_by(lat,rcp) %>%
  dplyr::summarise(meanofthemean = mean(mean),
                   lowofthemean = min(mean),
                   upofthemean = max(mean)) %>%
  ungroup()

```




```{R}
library(ggplot2)

```


```{R}
g1<-ggplot(evesummary[evesummary$rcp == 126 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = upofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))



gg1 <- ggplot_build(g1)

df2 <- data.frame(x = gg1$data[[1]]$x,
                  ymin = gg1$data[[1]]$y,
                  ymax = gg1$data[[3]]$y)
ggplot(evesummary[evesummary$rcp == 126 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  #geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess',span = 0.1, se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_smooth(aes(x = lat, y = upofthemean),method = 'loess',span = 0.1, se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))+
geom_ribbon(data = df2,aes(x = x, ymin = ymin, ymax = ymax), fill = 'red', alpha = 0.33)
```

```{R}
g1<-ggplot(evesummary[evesummary$rcp == 370 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = upofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))



gg1 <- ggplot_build(g1)

df2 <- data.frame(x = gg1$data[[1]]$x,
                  ymin = gg1$data[[1]]$y,
                  ymax = gg1$data[[3]]$y)
ggplot(evesummary[evesummary$rcp == 370 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  #geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess',span = 0.1, se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_smooth(aes(x = lat, y = upofthemean),method = 'loess',span = 0.1, se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))+
geom_ribbon(data = df2,aes(x = x, ymin = ymin, ymax = ymax), fill = 'red', alpha = 0.33)

```
```{R}

g1<-ggplot(evesummary[evesummary$rcp == 585 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  geom_smooth(aes(x = lat, y = upofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))



gg1 <- ggplot_build(g1)

df2 <- data.frame(x = gg1$data[[1]]$x,
                  ymin = gg1$data[[1]]$y,
                  ymax = gg1$data[[3]]$y)
ggplot(evesummary[evesummary$rcp == 585 & evesummary$lat>=-45,])+
  #geom_point(aes(x = lat, y = lowofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = meanofthemean),alpha = 0.3)+
  #geom_point(aes(x = lat, y = upofthemean),alpha = 0.3)+
  #geom_smooth(aes(x = lat, y = lowofthemean),method = 'loess',span = 0.1, se = F)+
  geom_smooth(aes(x = lat, y = meanofthemean),method = 'loess', span = 0.25,se = F)+
  #geom_smooth(aes(x = lat, y = upofthemean),method = 'loess',span = 0.1, se = F)+
  #geom_ribbon(aes(x = lat, ymin= lowofthemean,ymax=upofthemean), fill="red", alpha=0.4)+
  geom_hline(yintercept = 0)+
  theme_light()+
  theme(axis.text = element_text(color = 'black', size = 20))+
  scale_color_viridis_d()+
  coord_flip()+
  scale_y_continuous(limits = c(-0.15,0.15))+
geom_ribbon(data = df2,aes(x = x, ymin = ymin, ymax = ymax), fill = 'red', alpha = 0.33)


```

