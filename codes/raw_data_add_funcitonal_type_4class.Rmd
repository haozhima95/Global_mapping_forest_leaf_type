---
title: "create_four_cates"
author: "Haozhi Ma"
date: "5/21/2021"
output: html_document
---

This script is used for creating the four forest functional types. 


Load the dataset

```{R}

rawdatawithinfo <- read.csv('C:\\Users\\haozh\\Desktop\\LL\\GFBI_data\\raregfdata_with_habit_type_20211208.csv')

head(rawdatawithinfo)

unique(rawdatawithinfo$OrigValueStr)
nrow(rawdatawithinfo)
```

```{R}

library(dplyr)

```

```{R}

rawdataplotcount <- rawdatawithinfo %>%
  group_by(plot_id,year,LAT,LON) %>%
  summarise(ncomplete = sum(!is.na(OrigValueStr) & !is.na(leaftype)),
            nall = n())


```

```{R}

rawdataplotcount$cover = rawdataplotcount$ncomplete/rawdataplotcount$nall


head(rawdataplotcount,50L)


```
```{R}
nrow(rawdataplotcount[rawdataplotcount$cover<0.5,])

nonrep <- rawdataplotcount[rawdataplotcount$cover<0.5,]


nonrep
```
```{R}

repre <- rawdataplotcount[rawdataplotcount$cover>=0.5,]

rawdatawithinfo <- rawdatawithinfo %>%
  filter(plot_id %in% repre$plot_id)

```


```{R}
rawdatawithinfo <- rawdatawithinfo[complete.cases(rawdatawithinfo$leaftype),]
rawdatawithinfo <- rawdatawithinfo[complete.cases(rawdatawithinfo$OrigValueStr),]
nrow(rawdatawithinfo)
```

```{R}
sub.be <- rawdatawithinfo[rawdatawithinfo$OrigValueStr >= 0.5 & rawdatawithinfo$leaftype == 'A', ]
nrow(sub.be)
unique(sub.be$leaftype)
sub.bd <- rawdatawithinfo[rawdatawithinfo$OrigValueStr < 0.5 & rawdatawithinfo$leaftype == 'A', ]
nrow(sub.bd)
unique(sub.bd$leaftype)
sub.ne <- rawdatawithinfo[rawdatawithinfo$OrigValueStr >=0.5 & rawdatawithinfo$leaftype == 'G', ]
nrow(sub.ne)
unique(sub.ne$leaftype)
sub.nd <- rawdatawithinfo[rawdatawithinfo$OrigValueStr < 0.5 & rawdatawithinfo$leaftype == 'G', ]
nrow(sub.nd)
unique(sub.nd$leaftype)

```

```{R}
sub.be$broad_evergreen = 1
sub.be$broad_deciduous = 0
sub.be$needle_evergreen = 0
sub.be$needle_deciduous = 0
sub.be$class = 0

head(sub.be)
```

```{R}
sub.bd$broad_evergreen = 0
sub.bd$broad_deciduous = 1
sub.bd$needle_evergreen = 0
sub.bd$needle_deciduous = 0
sub.bd$class = 1

head(sub.bd)
```

```{R}
sub.ne$broad_evergreen = 0
sub.ne$broad_deciduous = 0
sub.ne$needle_evergreen = 1
sub.ne$needle_deciduous = 0
sub.ne$class = 2

head(sub.ne)
```
```{R}
sub.nd$broad_evergreen = 0
sub.nd$broad_deciduous = 0
sub.nd$needle_evergreen = 0
sub.nd$needle_deciduous = 1
sub.nd$class = 3

head(sub.nd)
```


```{R}

dswithcate <- rbind(sub.be,rbind(sub.bd,rbind(sub.ne,sub.nd)))

nrow(dswithcate)

head(dswithcate)


```

```{R}
library(readr)

write_csv(dswithcate, 'C:\\Users\\haozh\\Desktop\\LL\\GFBI_data\\dswithcate_with4class_20220809.csv')

```



